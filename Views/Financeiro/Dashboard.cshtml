@{
    ViewData["Title"] = "Dashboard Financeiro";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />

<!-- HEADER -->
<div class="container-fluid mb-4">
    <div class="bg-dark text-white p-4 rounded shadow-sm d-flex justify-content-between align-items-center">
        <h3 class="mb-0">
            <i class="bi bi-cash-coin"></i> Dashboard Financeiro
        </h3>
        <span class="text-muted small">Visão geral de entradas e saídas</span>
    </div>
</div>

<!-- RESUMO -->
<div class="container-fluid mb-4">
    <div class="row g-3">

        <!-- ENTRADA -->
        <div class="col-12 col-md-4">
            <div class="card shadow-sm border-0 resumo-card entrada">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total de Entradas</h6>
                            <h4 class="fw-bold text-success">
                                @ViewBag.TotalEntrada.ToString("C")
                            </h4>
                        </div>
                        <i class="bi bi-arrow-up-circle icon text-success"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- SAÍDA -->
        <div class="col-12 col-md-4">
            <div class="card shadow-sm border-0 resumo-card saida">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total de Saídas</h6>
                            <h4 class="fw-bold text-danger">
                                @ViewBag.TotalSaida.ToString("C")
                            </h4>
                        </div>
                        <i class="bi bi-arrow-down-circle icon text-danger"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- SALDO -->
        <div class="col-12 col-md-4">
            <div class="card shadow-sm border-0 resumo-card saldo">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Saldo Atual</h6>
                            <h4 class="fw-bold text-primary">
                                @ViewBag.Saldo.ToString("C")
                            </h4>
                        </div>
                        <i class="bi bi-wallet2 icon text-primary"></i>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- GRÁFICOS -->
<div class="container-fluid">
    <div class="row g-3">

        <!-- LINHA -->
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header fw-bold">
                    Fluxo Financeiro Diário
                </div>
                <div class="card-body">
                    <canvas id="chartLinhas"></canvas>
                </div>
            </div>
        </div>

        <!-- PIZZA -->
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header fw-bold">
                    Proporção Entradas x Saídas
                </div>
                <div class="card-body">
                    <canvas id="chartPizza"></canvas>
                </div>
            </div>
        </div>

        <!-- BARRAS -->
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header fw-bold">
                    Entradas e Saídas por Período
                </div>
                <div class="card-body">
                    <canvas id="chartBarras"></canvas>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
    body {
        background-color: #f4f6f9;
    }

    .resumo-card {
        border-radius: 12px;
    }

    .icon {
        font-size: 2.5rem;
        opacity: 0.8;
    }
</style>

<!-- CHARTS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const labels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.Labels));
    const entradas = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.ValoresEntrada));
    const saidas = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.ValoresSaida));
    const totalEntrada = @ViewBag.TotalEntrada;
    const totalSaida = @ViewBag.TotalSaida;

    // LINHA
    new Chart(chartLinhas, {
        type: 'line',
        data: {
            labels,
            datasets: [
                {
                    label: 'Entradas',
                    data: entradas,
                    borderColor: '#198754',
                    backgroundColor: 'rgba(25,135,84,0.2)',
                    tension: 0.3
                },
                {
                    label: 'Saídas',
                    data: saidas,
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220,53,69,0.2)',
                    tension: 0.3
                }
            ]
        },
        options: { responsive: true }
    });

    // PIZZA
    new Chart(chartPizza, {
        type: 'doughnut',
        data: {
            labels: ['Entradas', 'Saídas'],
            datasets: [{
                data: [totalEntrada, totalSaida],
                backgroundColor: ['#198754', '#dc3545']
            }]
        },
        options: { responsive: true }
    });

    // BARRAS
    new Chart(chartBarras, {
        type: 'bar',
        data: {
            labels,
            datasets: [
                {
                    label: 'Entradas',
                    data: entradas,
                    backgroundColor: '#198754'
                },
                {
                    label: 'Saídas',
                    data: saidas,
                    backgroundColor: '#dc3545'
                }
            ]
        },
        options: { responsive: true }
    });
</script>
