@{
    ViewData["Title"] = "Gestão de Fornecedores";
}

<h2>Fornecedores</h2>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Id</th>
            <th>Nome</th>
            <th>Empresa</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Produto/Serviço</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody id="fornecedores"></tbody>
</table>

<!-- Botão para abrir formulário -->
<button class="btn btn-primary" onclick="mostrarFormulario()">➕ Adicionar Fornecedor</button>

<!-- Formulário oculto -->
<div id="formulario" style="display:none; margin-top:20px;">
    <h3>Novo Fornecedor</h3>
    <label>Nome:</label>
    <input type="text" id="nome" class="form-control" />
    <label>Empresa:</label>
    <input type="text" id="empresa" class="form-control" />
    <label>Telefone:</label>
    <input type="text" id="telefone" class="form-control" />
    <label>Email:</label>
    <input type="text" id="email" class="form-control" />
    <label>Produto/Serviço:</label>
    <input type="text" id="produto" class="form-control" />

    <button class="btn btn-success" onclick="salvarFornecedor()">Salvar</button>
    <button class="btn btn-secondary" onclick="cancelarFormulario()">Cancelar</button>
</div>

@section Scripts {
    <script>
        async function carregarFornecedores() {
            const resp = await fetch('/Fornecedor/Listar');
            const fornecedores = await resp.json();
            const tbody = document.getElementById("fornecedores");
            tbody.innerHTML = "";
            fornecedores.forEach(f => {
                tbody.innerHTML += `<tr>
                    <td>${f.id}</td>
                    <td>${f.nome}</td>
                    <td>${f.empresa}</td>
                    <td>${f.telefone}</td>
                    <td>${f.email}</td>
                    <td>${f.produto}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editarFornecedor(${f.id})">✏️ Editar</button>
                        <button class="btn btn-danger" onclick="apagarFornecedor(${f.id})">🗑️ Apagar</button>
                    </td>
                </tr>`;
            });
        }

        async function salvarFornecedor() {
            const fornecedor = {
                nome: document.getElementById("nome").value,
                empresa: document.getElementById("empresa").value,
                telefone: document.getElementById("telefone").value,
                email: document.getElementById("email").value,
                produto: document.getElementById("produto").value
            };

            await fetch('/Fornecedor/Adicionar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(fornecedor)
            });

            cancelarFormulario();
            carregarFornecedores();
        }

        async function editarFornecedor(id) {
            const nome = prompt("Novo nome:");
            const empresa = prompt("Nova empresa:");
            const telefone = prompt("Novo telefone:");
            const email = prompt("Novo email:");
            const produto = prompt("Novo produto/serviço:");

            const fornecedor = { nome, empresa, telefone, email, produto };

            await fetch(`/Fornecedor/Editar/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(fornecedor)
            });

            carregarFornecedores();
        }

        async function apagarFornecedor(id) {
            if (!confirm("Deseja realmente apagar este fornecedor?")) return;

            await fetch(`/Fornecedor/Apagar/${id}`, { method: 'DELETE' });
            carregarFornecedores();
        }

        function mostrarFormulario() {
            document.getElementById("formulario").style.display = "block";
        }

        function cancelarFormulario() {
            document.getElementById("formulario").style.display = "none";
        }

        // Carrega fornecedores ao abrir a página
        carregarFornecedores();
    </script>
}
